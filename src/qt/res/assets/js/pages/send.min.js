var sendPage;$(function(){sendPage=function(){function t(t){return t?2==t.at&&""===$("#send-balance .pay_to").val()&&($("#send-balance .pay_to").val(t.address).change(),$("#send-balance .pay_to").data("address",t.address)):$("#send-balance .pay_to").val($("#send-balance .pay_to").data("address")).change(),!0}function e(t){void 0===t&&(t=$(".show-coin-control .btn-cons").hasClass("active")),$("#coincontrol").toggle(t)}function n(){return $("div.recipient").length}function o(){$("#recipients").append(((0==n()?"":"<hr />")+s.replace(/recipient-template/g,"recipient[count]")).replace(/\[count\]/g,++p)),$("#recipient"+p.toString()+" [data-title]").tooltip(),$("#amount"+p.toString()).on("keydown",unit.keydown).on("paste",unit.paste),"undefined"!=typeof bridge&&bridge.userAction(["clearRecipients"]);var t=$("[name=transaction_type_to]:checked").val();$(".to_unit_public").css("display","public"===t?"block":"none"),$(".to_unit_private").css("display","private"===t?"block":"none")}function i(){$("#recipients").html(""),$("#send-balance .amount").val("0").change(),o(),t(),c()}function c(){numOfRecipients=0}function a(t,e){function n(){numOfRecipients++;var t=$(this).find(".pay_to"),e=$(this).find(".amount"),n=$(this).find(".narration").val();void 0===n&&(n=""),bridge.addRecipient(t.val(),$(this).find(".pay_to_label").val(),n,unit.parse(e.val(),$(this).find(".unit").val()),o,$("#ring_size").val())}if(void 0!==t)t&&i();else if(void 0!==e)e&&(numOfRecipients--,0==numOfRecipients&&bridge.sendCoins($("#coincontrol").is(":visible"),$("#change_address").val()));else{var o=r();bridge.userAction(["clearRecipients"]),$("#send-balance").is(":visible")?$("#send-balance").each(n):$("div.recipient").each(n)}}function l(e){var n=$("#send-main").is(":visible"),o=$("[name=transaction_type_from]:checked").val(),i=$("[name=transaction_type_to]:checked").val();console.log("OPEN"),console.log(o),e&&(e.target!==$("input#to_account_public")[0]&&e.target!==$("input#to_account_private")[0]?(i=n?o:"public"===o?"private":"public",$("input[name=transaction_type_to][value="+i+"]").prop("checked",!0)):n||(o="public"===i?"private":"public",$("input[name=transaction_type_from][value="+o+"]").prop("checked",!0)));var c=$("[name=transaction_type_to  ]:checked").val(),a=r();$("#spend_spec").toggle("public"===o),$("#spend_spectre").toggle("private"===o),$("#tx_ringsize").toggle("private"===o),$("#to_spec").toggle("public"===c),$("#to_spectre").toggle("private"===c),$("#to_balance").toggle(!n),$(".show-coin-control").toggle(a<1),sendPage.toggleCoinControl(a<0),$(".advanced_controls").toggle(!n),$("#add_recipient").toggle($("#send-main").is(":visible")),$(".to_unit_public").css("display","public"===i?"block":"none"),$(".to_unit_private").css("display","private"===i?"block":"none"),n||t()}function r(){var t="public"===$("[name=transaction_type_from]:checked").val(),e="public"===$("[name=transaction_type_to  ]:checked").val();return t?+!e:2+e}var s=$("#recipient-template")[0].outerHTML,p=0;return $("#recipient-template").remove(),{init:function(){e(!1),o(),l(),$(".advanced_controls").toggle(!1),$("#send [name^=transaction_type]").on("change",l),$("#send [data-toggle=tab]").on("shown.bs.tab",l)},initSendBalance:t,toggleCoinControl:e,addRecipient:o,addRecipientDetail:function(t,e,n,o){i(),$("#recipient"+p.toString()+" .pay_to").val(t).change(),$("#recipient"+p.toString()+" .pay_to_label").val(e).change(),$("#recipient"+p.toString()+" .amount").val(o).change(),$("#recipient"+p.toString()+" .narration").val(n).change(),$("[href=#send]").click()},clearRecipients:i,removeRecipient:function(t){n()<=1?i():(0==(t=$(t)).next("hr").remove().length&&t.prev("hr").remove(),t.remove(),$("#tooltip").remove())},sendCoins:function(){c(),a()},update:a,updateCoinControl:function(){if($("#coincontrol").is(":visible")){for(var t=0,e=0;e<recipients;e++)t+=unit.parse($("#amount"+e).val());bridge.updateCoinControlAmount(t)}},updateCoinControlInfo:function(t,e,n,o,i,c,a,l){$("#coincontrol").is(":visible")&&($("#coincontrol_auto").toggle(0===t),$("#coincontrol_labels").toggle(t>0),t>0?($("#coincontrol_quantity").text(t),$("#coincontrol_amount").text(unit.format(e)),$("#coincontrol_fee").text(unit.format(n)),$("#coincontrol_afterfee").text(unit.format(o)),$("#coincontrol_bytes").text("~"+i).css("color",i>1e4?"red":null),$("#coincontrol_priority").text(c).css("color",0==c.indexOf("low")?"red":null),$("#coincontrol_low").text(a).toggle(l).css("color","yes"==a?"red":null),$("#coincontrol_change").text(unit.format(l)).toggle(l),$("label[for='coincontrol_low'],label[for='coincontrol_change']").toggle(l)):($("#coincontrol_quantity").text(""),$("#coincontrol_amount").text(""),$("#coincontrol_fee").text(""),$("#coincontrol_afterfee").text(""),$("#coincontrol_bytes").text(""),$("#coincontrol_priority").text(""),$("#coincontrol_low").text(""),$("#coincontrol_change").text("")))},changeTransactionType:l}}()});
